<!doctype html><html lang=en><head><title>How to copy files temporarily in Dockerfile · KK's Blog (fromkk)</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="KK"><meta name=description content="It&rsquo;s very common to copy a local file into the container when build docker image. In general, we use COPY command. But it creates a new layer and increase the final image size. If this is a temporal file and we don&rsquo;t want users waste their storage space, how can we remove it? Here are some approaches.
Download the File Dynamically Link to heading If the file can be download from URL or you can create a local HTTP server to share the file, you can download the file, use it and delete it in one RUN command."><meta name=keywords content="fromkk,blog,kk blog,developer,personal,python,golang,go,linux,machine learning"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to copy files temporarily in Dockerfile"><meta name=twitter:description content="It&rsquo;s very common to copy a local file into the container when build docker image. In general, we use COPY command. But it creates a new layer and increase the final image size. If this is a temporal file and we don&rsquo;t want users waste their storage space, how can we remove it? Here are some approaches.
Download the File Dynamically Link to heading If the file can be download from URL or you can create a local HTTP server to share the file, you can download the file, use it and delete it in one RUN command."><meta property="og:title" content="How to copy files temporarily in Dockerfile"><meta property="og:description" content="It&rsquo;s very common to copy a local file into the container when build docker image. In general, we use COPY command. But it creates a new layer and increase the final image size. If this is a temporal file and we don&rsquo;t want users waste their storage space, how can we remove it? Here are some approaches.
Download the File Dynamically Link to heading If the file can be download from URL or you can create a local HTTP server to share the file, you can download the file, use it and delete it in one RUN command."><meta property="og:type" content="article"><meta property="og:url" content="https://www.fromkk.com/posts/how-to-copy-files-temporarily-in-dockerfile/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-24T11:49:00+08:00"><meta property="article:modified_time" content="2023-09-02T15:58:40+08:00"><link rel=canonical href=https://www.fromkk.com/posts/how-to-copy-files-temporarily-in-dockerfile/><link rel=preload href="https://www.fromkk.com/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://www.fromkk.com/css/coder.min.ea4c355c5f9913809f506132a80bf3fab84f2679dee370f334f7385a36d24c38.css integrity="sha256-6kw1XF+ZE4CfUGEyqAvz+rhPJnne43DzNPc4WjbSTDg=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://www.fromkk.com/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=https://www.fromkk.com/images/favicon.svg sizes=any><link rel=icon type=image/png href=https://www.fromkk.com/icons/icon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://www.fromkk.com/icons/icon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://www.fromkk.com/icons/icon-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://www.fromkk.com/icons/icon-192x192.png><link rel=manifest href=https://www.fromkk.com/site.webmanifest><link rel=mask-icon href=https://www.fromkk.com/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://www.fromkk.com/>KK's Blog (fromkk)</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://www.fromkk.com/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://www.fromkk.com/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=https://www.fromkk.com/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://www.fromkk.com/posts/index.xml>RSS</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.fromkk.com/posts/how-to-copy-files-temporarily-in-dockerfile/>How to copy files temporarily in Dockerfile</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2023-08-24T11:49:00+08:00>08/24/2023</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
2-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://www.fromkk.com/tags/dockerfile/>dockerfile</a></span></div></div></header><div class=post-content><p>It&rsquo;s very common to copy a local file into the container when build docker image. In general, we use <code>COPY</code> command. But it creates a new layer and increase the final image size. If this is a temporal file and we don&rsquo;t want users waste their storage space, how can we remove it? Here are some approaches.</p><h2 id=download-the-file-dynamically>Download the File Dynamically
<a class=heading-link href=#download-the-file-dynamically><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>If the file can be download from URL or you can create a local HTTP server to share the file, you can download the file, use it and delete it in one <code>RUN</code> command. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>RUN</span> wget xxxx <span style=color:#f92672>&amp;&amp;</span> unzip xxx <span style=color:#f92672>&amp;&amp;</span> rm xxx<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h2 id=run-mount-command>RUN &ndash;mount Command
<a class=heading-link href=#run-mount-command><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>You can also mount file when build image if your file can&rsquo;t be download from Internet or the file is secret. Use it to bind files or directories to the build container. A bind mount is read-only by default, add <code>rw</code> parameter to make it writable.</p><p>If you bind the directory, the changes in the build container does not reflect to host.</p><p>The mounted folder are kept in the image, but the files are gone. Don&rsquo;t forget to delete the empty folder if you want to keep image clean.</p><h3 id=mount-folder>Mount folder
<a class=heading-link href=#mount-folder><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,target<span style=color:#f92672>=</span>/target_dir/,source<span style=color:#f92672>=</span>./source_dir/,rw<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=mount-file>Mount file
<a class=heading-link href=#mount-file><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,target<span style=color:#f92672>=</span>/azure-cli.rpm,source<span style=color:#f92672>=</span>./docker/azure-cli.rpm tdnf install ca-certificates /azure-cli.rpm -y <span style=color:#f92672>&amp;&amp;</span> tdnf clean all<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h2 id=squash-option>&ndash;squash Option
<a class=heading-link href=#squash-option><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>You can also use <code>--squash</code> to reduce image size.
Once the build is complete, Docker creates a new image loading the diffs from each layer into a single new layer and references all the parent&rsquo;s layers. So the extra space created by <code>COPY</code> command can be freed by <code>squash</code>.</p><p>Ref:</p><ol><li><a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/ class=external-link target=_blank rel=noopener>Dockerfile best practice</a></li><li><a href=https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/reference.md#run---mount class=external-link target=_blank rel=noopener>RUN &ndash;mount</a></li><li><a href=https://stackoverflow.com/questions/41764336/how-does-the-new-docker-squash-work class=external-link target=_blank rel=noopener>How does the new Docker &ndash;squash work</a></li></ol></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme"),themeInParams="preferred-color-scheme";getTheme==null&&(themeInParams!==""&&themeInParams!=="auto"?getTheme=themeInParams:getTheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","bebound/bebound.github.io"),s.setAttribute("issue-term","pathname"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css integrity=sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0 crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js integrity=sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})'></script></section></div><footer class=footer><section class=container>©
2023
KK
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=https://www.fromkk.com/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-153788833-1","auto"),ga("send","pageview"))</script></body></html>