<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta name=author content="KK"><meta name=description content="I wrote a Scala code to get the current time. However, the output is different on the development server and docker.
import java.util.Calendar  println(Calendar.getInstance().getTime) On my development server, it outputs Sun Oct 18 18:01:01 CST 2020, but in docker, it print a UTC time.
I guess it related to the timezone setting and do a research, here is the result.
How Did JVM Detect Timezone    All of the code can be found in this function: private static synchronized TimeZone setDefaultZone()"><meta name=keywords content="fromkk,blog,kk blog,developer,personal,python,golang,go,linux,machine learning"><meta name=twitter:card content="summary"><meta name=twitter:title content="Timezone in JVM"><meta name=twitter:description content="I wrote a Scala code to get the current time. However, the output is different on the development server and docker.
import java.util.Calendar  println(Calendar.getInstance().getTime) On my development server, it outputs Sun Oct 18 18:01:01 CST 2020, but in docker, it print a UTC time.
I guess it related to the timezone setting and do a research, here is the result.
How Did JVM Detect Timezone    All of the code can be found in this function: private static synchronized TimeZone setDefaultZone()"><meta property="og:title" content="Timezone in JVM"><meta property="og:description" content="I wrote a Scala code to get the current time. However, the output is different on the development server and docker.
import java.util.Calendar  println(Calendar.getInstance().getTime) On my development server, it outputs Sun Oct 18 18:01:01 CST 2020, but in docker, it print a UTC time.
I guess it related to the timezone setting and do a research, here is the result.
How Did JVM Detect Timezone    All of the code can be found in this function: private static synchronized TimeZone setDefaultZone()"><meta property="og:type" content="article"><meta property="og:url" content="https://www.fromkk.com/posts/timezone-in-jvm/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-10-18T23:49:00+08:00"><meta property="article:modified_time" content="2020-10-19T00:00:15+08:00"><title>Timezone in JVM · KK's Blog (fromkk)</title><link rel=canonical href=https://www.fromkk.com/posts/timezone-in-jvm/><link rel=preload href="https://www.fromkk.com/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://www.fromkk.com/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://www.fromkk.com/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://www.fromkk.com/icons/icon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://www.fromkk.com/icons/icon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://www.fromkk.com/icons/icon-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://www.fromkk.com/icons/icon-192x192.png><meta name=generator content="Hugo 0.94.2"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://www.fromkk.com/>KK's Blog (fromkk)</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://www.fromkk.com/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://www.fromkk.com/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=https://www.fromkk.com/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://www.fromkk.com/posts/index.xml>RSS</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.fromkk.com/posts/timezone-in-jvm/>Timezone in JVM</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-10-18T23:49:00+08:00>10/18/2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
2-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://www.fromkk.com/tags/java/>Java</a></span>
<span class=separator>•</span>
<span class=tag><a href=https://www.fromkk.com/tags/scala/>Scala</a></span></div></div></header><div><p>I wrote a Scala code to get the current time. However, the output is different on the development server and docker.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>import</span> java.util.Calendar
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>println<span style=color:#f92672>(</span><span style=color:#a6e22e>Calendar</span><span style=color:#f92672>.</span>getInstance<span style=color:#f92672>().</span>getTime<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>On my development server, it outputs <code>Sun Oct 18 18:01:01 CST 2020</code>, but in docker, it print a UTC time.</p><p>I guess it related to the timezone setting and do a research, here is the result.</p><h2 id=how-did-jvm-detect-timezone>How Did JVM Detect Timezone
<a class=heading-link href=#how-did-jvm-detect-timezone><i class="fa fa-link" aria-hidden=true></i></a></h2><p>All of the code can be found in this function: <code>private static synchronized TimeZone setDefaultZone()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>  String zoneID <span style=color:#f92672>=</span> AccessController<span style=color:#f92672>.</span><span style=color:#a6e22e>doPrivileged</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> GetPropertyAction<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;user.timezone&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// if the time zone ID is not set (yet), perform the
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// platform to Java time zone ID mapping.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>zoneID <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> zoneID<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      String javaHome <span style=color:#f92672>=</span> AccessController<span style=color:#f92672>.</span><span style=color:#a6e22e>doPrivileged</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>new</span> GetPropertyAction<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;java.home&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          zoneID <span style=color:#f92672>=</span> getSystemTimeZoneID<span style=color:#f92672>(</span>javaHome<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>zoneID <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>              zoneID <span style=color:#f92672>=</span> GMT_ID<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NullPointerException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          zoneID <span style=color:#f92672>=</span> GMT_ID<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>First, it will check whether JVM has <code>user.timezone</code> property. If not, it will call this native method <code>getSystemTimeZoneID</code>, it was implemented in <a href=https://github.com/AdoptOpenJDK/openjdk-jdk9u-backup-03-sep-2018/blob/master/jdk/src/java.base/share/native/libjava/TimeZone.c>java.base/share/native/libjava/TimeZone.c</a>, and the main logic is in <a href=https://github.com/AdoptOpenJDK/openjdk-jdk9u-backup-03-sep-2018/blob/17007f6a09f553801fd424d3c71382717975f66d/jdk/src/java.base/unix/native/libjava/TimeZone%5Fmd.c>java.base/unix/native/libjava/TimeZone_md.c</a>.</p><p>In <code>Timezone_md.c</code>, it will find timezone by following steps, it will return the timezone immediately once found.</p><ol><li>Find <code>TZ</code> environment.</li><li>Read <code>/etc/timezone</code>.</li><li>Read <code>/etc/localtime</code>. If it is a soft link(ex: <code>/usr/share/zoneinfo/Asia/Shanghai</code>), return timezone by path. Otherwise, compare the content with all files in <code>/usr/share/zoneinfo</code>, if found, return timezone.</li><li>Return <code>GMT</code> as timezone.</li></ol><h2 id=how-to-change-timezone>How to Change Timezone
<a class=heading-link href=#how-to-change-timezone><i class="fa fa-link" aria-hidden=true></i></a></h2><p>The available timezone in Linux can be listed by this command: <code>timedatectl list-timezones</code></p><h3 id=add-jvm-param>Add JVM param
<a class=heading-link href=#add-jvm-param><i class="fa fa-link" aria-hidden=true></i></a></h3><p>You can add <code>-Duser.timezone=Asia/Shanghai</code> as JVM parameters.</p><h3 id=set-tz-environment-variable>Set TZ environment variable
<a class=heading-link href=#set-tz-environment-variable><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Add <code>export TZ=Asia/Shanghai</code> in <code>.bashrc</code>.</p><h3 id=change-etc-timezone>Change <code>/etc/timezone</code>
<a class=heading-link href=#change-etc-timezone><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Set its content to <code>Asia/Shanghai</code></p><h3 id=change-etc-localtime>Change <code>/etc/localtime</code>
<a class=heading-link href=#change-etc-localtime><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Link it to <code>/usr/share/zoneinfo/Asia/Shanghai</code></p><h3 id=change-timezone-manually-in-java-program>Change timezone manually in Java Program
<a class=heading-link href=#change-timezone-manually-in-java-program><i class="fa fa-link" aria-hidden=true></i></a></h3><p>All of these methods should work</p><ul><li>Add this line before get time: <code>TimeZone.setDefault(TimeZone.getTimeZone("Asia/Shanghai"))</code></li><li>Set JVM property by code <code>System.setProperty("user.timezone", "Asia/Shanghai")</code></li><li>Set timezone manually in Calendar <code>Calendar.getInstance(TimeZone.getTimeZone("Asia/Shanghai"))</code></li></ul><h2 id=ref>Ref:
<a class=heading-link href=#ref><i class="fa fa-link" aria-hidden=true></i></a></h2><ol><li><a href=https://www.baeldung.com/java-jvm-time-zone>How to Set the JVM Time Zone</a></li><li><a href=https://cloud.tencent.com/developer/article/1175487>jvm linux 时区设置</a></li><li><a href=http://kaiwangchen.github.io/2018/09/30/java-timezone-revisited.html>Java default timezone detection, revisited</a></li><li><a href=https://www.cnblogs.com/darange/p/9368245.html>Java读取系统默认时区</a></li><li><a href=https://stackoverflow.com/questions/2493749/how-to-set-a-jvm-timezone-properly/64415095#64415095>How to set a JVM TimeZone Properly</a></li></ol></div><footer><script src=https://utteranc.es/client.js repo=bebound/bebound.github.io issue-term=pathname label=comment theme=preferred-color-scheme crossorigin=anonymous async></script></footer></article><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})'></script></section></div><footer class=footer><section class=container>©
2022
KK
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=https://www.fromkk.com/js/coder.min.8fb86376a16e684af472a329aef502dbebcfab65ce264e9750d144912947c602.js integrity="sha256-j7hjdqFuaEr0cqMprvUC2+vPq2XOJk6XUNFEkSlHxgI="></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-153788833-1","auto"),ga("send","pageview"))</script></body></html>